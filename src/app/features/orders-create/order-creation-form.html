<div class="h-full flex flex-col max-w-[900px] m-auto lg:mt-1">

  <div class="bg-surface-0 dark:bg-surface-800 rounded-lg shadow-sm border border-surface-200 dark:border-surface-700 p-6">
    <form [formGroup]="form" (ngSubmit)="submit()" class="space-y-6">
      <div>
        <label class="block text-sm font-medium mb-2" for="table-id">Mesa (ID)</label>
        <input id="table-id" type="number" formControlName="table" min="1" class="w-full border border-surface-300 dark:border-surface-700 rounded p-2 bg-surface-100 dark:bg-surface-700" placeholder="Ej. 5" />
      </div>
      <div>


        <div class="space-y-4">
          @for (co of clientOrders.controls; track $index; let i = $index) {
          <div class="rounded border bg-surface-100 dark:bg-surface-800  border-surface-300 dark:border-surface-700 p-4">
            <div class="flex items-center justify-between mb-3">
              <div class="font-medium">Orden de cliente</div>
            </div>

            <div class="space-y-3">
              <div class="flex items-center justify-between">
                <div class="text-sm font-medium">Detalles</div>
                <button type="button" (click)="addDetail(i)" class="px-2 py-1 rounded bg-surface-200 dark:bg-surface-700 hover:bg-surface-200 dark:hover:bg-surface-600 text-sm">Agregar producto</button>
              </div>

              <div class="space-y-3">
                @for (d of detailsAt(i).controls; track $index; let j = $index) {
                <div class="grid grid-cols-1 md:grid-cols-4 gap-3 items-end border  border-surface-300 dark:border-surface-700 rounded p-3 bg-primary-contrast" [formGroup]="$any(detailsAt(i).at(j))">
                  <div>
                    <label class="block text-xs mb-1" [attr.for]="'product-' + i + '-' + j">Producto {{j + 1}}</label>
                    <select [id]="'product-' + i + '-' + j" formControlName="product" class="w-full border  border-surface-300 dark:border-surface-700 rounded p-2 bg-transparent">
                      <option [ngValue]="null" disabled>Seleccione un producto</option>
                      @for (product of products; track product.id) {
                        <option [ngValue]="product.id">{{ product.name }} Â· {{ product.price | currency:'COP':'symbol-narrow' }}</option>
                      }
                    </select>
                  </div>
                  <div>
                    <label class="block text-xs mb-1" [attr.for]="'quantity-' + i + '-' + j">Cantidad</label>
                    <input [id]="'quantity-' + i + '-' + j" type="number" formControlName="quantity" min="1" class="w-full border  border-surface-300 dark:border-surface-700 rounded p-2 bg-transparent" />
                  </div>
                  <div>
                    <label class="block text-xs mb-1" [attr.for]="'observations-' + i + '-' + j">Observaciones</label>
                    <input [id]="'observations-' + i + '-' + j" type="text" formControlName="observations" class="w-full border  border-surface-300 dark:border-surface-700 rounded p-2 bg-transparent"/>
                  </div>
                  <div>
                    <label class="block text-xs mb-1" [attr.for]="'subproducts-' + i + '-' + j">Para menu del dia</label>
                    <input [id]="'subproducts-' + i + '-' + j" type="text" formControlName="subProducts" class="w-full border  border-surface-300 dark:border-surface-700 rounded p-2 bg-transparent" placeholder="Ej. 1, 2, 3 " />
                  </div>
                  <div class="md:col-span-4 flex justify-end">
                    <button type="button" (click)="removeDetail(i, j)" class="text-sm text-surface-600 pointer hover:underline" [disabled]="detailsAt(i).length === 1"><i class="pi pi-trash"></i></button>
                  </div>
                </div>
                }
              </div>
            </div>
          </div>
          }
        </div>
      </div>

      <div class="flex gap-2">
        <button type="submit" class="px-4 py-2 rounded bg-primary-500 text-white hover:bg-primary-600 disabled:opacity-60" [disabled]="isSubmitDisabled">Crear pedido</button>
      </div>
    </form>
  </div>
</div>
