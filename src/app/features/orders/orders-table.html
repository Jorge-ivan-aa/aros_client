<div class="mb-3 pb-4 flex justify-between gap-3 flex-wrap">
  <div class="flex gap-3 flex-wrap">
    <label for="statusFilter" class="mr-2 text-surface-700 dark:text-surface-200">Filtrar por:</label>
    <p-select [options]="comboStatusOptions" [(ngModel)]="comboOptions" placeholder="Categoria" class="w-[220px]"
      (onChange)="onOptionChange($event.value)" />
    <!-- Datepicker shared component placed next to the combo box -->
    <app-shared-datepicker (dateChange)="onDateChange($event)"></app-shared-datepicker>
  </div>

  <div class="flex items-center gap-2">

    <p-button icon="pi pi-save" label="Guardar cambios" (onClick)="saveChanges()"
      [disabled]="!hasUnsavedChanges || saving" [loading]="saving" />

  </div>
 @if (hasUnsavedChanges) {
  <span class="text-sm text-red-400 ">
    {{ unsavedChangesCount }} cambio(s) sin guardar
  </span>
  }
</div>

<p-table [value]="orders" [scrollable]="true" scrollHeight="80vh" >
  <ng-template pTemplate="header">
    <tr>
      <th>ID</th>
      <th>Estado</th>
      <th>Fecha</th>
      <th>Mesa</th>
      <th>Precio Total</th>
    </tr>
  </ng-template>
  <ng-template pTemplate="body" let-order>
    <tr>
      <td>{{ order.id }}</td>
      <td>
        <p-select [options]="statusOptions" [(ngModel)]="order.status" (onChange)="onStatusChange(order, $event.value)"
          placeholder="Seleccionar estado" optionLabel="label" optionValue="value" [style]="{'width': '200px'}" />
      </td>
      <td>{{ formatDate(order.date) }}</td>
      <td>
        <input pInputText type="text" [(ngModel)]="order.table" (ngModelChange)="onFieldChange(order, 'table', $event)"
          placeholder="Nombre de mesa" class="w-full" />
      </td>
      <td>{{ order.totalPrice | currency:'COP':'symbol':'1.2-2' }}</td>
    </tr>
  </ng-template>
</p-table>

@if (loading) {
<div class="mt-4 text-surface-600 dark:text-surface-300">Cargando pedidos...</div>
}
@if (error) {
<div class="mt-4 text-red-600">{{ error }}</div>
}
